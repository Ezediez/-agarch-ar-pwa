import{j as e,c as t,P as s,b as a,e as i,f as r,a as l,B as o,u as n,g as c,d,h as u,D as p}from"./index-Do9EHXoG.js";import{r as m,R as h}from"./vendor-npDLdgAy.js";import{m as x,q as f,n as g,p as w,r as b,d as v,c as j,w as y,y as N,e as _}from"./firebase-CUPWofxp.js";import{af as k,ag as S,ah as C,_ as P,L as E,Y as A,ai as I,l as L,n as R,f as M,H as T}from"./ui-Bgh-uqQH.js";import{u as O}from"./router-Ba8Cb_LR.js";var z={exports:{}},V={},D=m;var $="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},U=D.useState,F=D.useEffect,q=D.useLayoutEffect,B=D.useDebugValue;function K(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!$(e,s)}catch(a){return!0}}var W="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var s=t(),a=U({inst:{value:s,getSnapshot:t}}),i=a[0].inst,r=a[1];return q(function(){i.value=s,i.getSnapshot=t,K(i)&&r({inst:i})},[e,s,t]),F(function(){return K(i)&&r({inst:i}),e(function(){K(i)&&r({inst:i})})},[e]),B(s),s};V.useSyncExternalStore=void 0!==D.useSyncExternalStore?D.useSyncExternalStore:W,z.exports=V;var H=z.exports;function Y(){return()=>{}}var G="Avatar",[J,Q]=t(G),[X,Z]=J(G),ee=m.forwardRef((t,a)=>{const{__scopeAvatar:i,...r}=t,[l,o]=m.useState("idle");return e.jsx(X,{scope:i,imageLoadingStatus:l,onImageLoadingStatusChange:o,children:e.jsx(s.span,{...r,ref:a})})});ee.displayName=G;var te="AvatarImage",se=m.forwardRef((t,r)=>{const{__scopeAvatar:l,src:o,onLoadingStatusChange:n=()=>{},...c}=t,d=Z(te,l),u=function(e,{referrerPolicy:t,crossOrigin:s}){const a=H.useSyncExternalStore(Y,()=>!0,()=>!1),r=m.useRef(null),l=a?(r.current||(r.current=new window.Image),r.current):null,[o,n]=m.useState(()=>re(l,e));return i(()=>{n(re(l,e))},[l,e]),i(()=>{const e=e=>()=>{n(e)};if(!l)return;const a=e("loaded"),i=e("error");return l.addEventListener("load",a),l.addEventListener("error",i),t&&(l.referrerPolicy=t),"string"==typeof s&&(l.crossOrigin=s),()=>{l.removeEventListener("load",a),l.removeEventListener("error",i)}},[l,s,t]),o}(o,c),p=a(e=>{n(e),d.onImageLoadingStatusChange(e)});return i(()=>{"idle"!==u&&p(u)},[u,p]),"loaded"===u?e.jsx(s.img,{...c,ref:r,src:o}):null});se.displayName=te;var ae="AvatarFallback",ie=m.forwardRef((t,a)=>{const{__scopeAvatar:i,delayMs:r,...l}=t,o=Z(ae,i),[n,c]=m.useState(void 0===r);return m.useEffect(()=>{if(void 0!==r){const e=window.setTimeout(()=>c(!0),r);return()=>window.clearTimeout(e)}},[r]),n&&"loaded"!==o.imageLoadingStatus?e.jsx(s.span,{...l,ref:a}):null});function re(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}ie.displayName=ae;var le=ee,oe=se,ne=ie;h.forwardRef(({className:t,...s},a)=>e.jsx(le,{ref:a,className:r("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s})).displayName=le.displayName;h.forwardRef(({className:t,...s},a)=>e.jsx(oe,{ref:a,className:r("aspect-square h-full w-full",t),...s})).displayName=oe.displayName;h.forwardRef(({className:t,...s},a)=>e.jsx(ne,{ref:a,className:r("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...s})).displayName=ne.displayName;const ce=({ad:t})=>{const{toast:s}=l(),a=(e,a)=>{if("promo"!==t.type)s({title:"‚ö†Ô∏è Salir de la app",description:"Est√°s saliendo de la aplicaci√≥n para contactar al anunciante.",duration:3e3}),setTimeout(()=>{switch(e){case"contact_phone":window.location.href=`tel:${a}`;break;case"contact.email":window.location.href=`mailto:${a}`;break;case"website":window.open(a,"_blank");break;case"whatsapp":window.open(`https://wa.me/${a.replace(/[^0-9]/g,"")}`,"_blank")}},1500);else switch(t.promo_type){case"VIP":s({title:"üéØ VIP - Funcionalidad en desarrollo",description:"Muy pronto podr√°s obtener VIP para destacar tu perfil.",duration:3e3});break;case"AUTOMARKET":window.open(t.website,"_blank")}},i=["bg-gradient-to-br from-blue-500 to-purple-600","bg-gradient-to-br from-green-500 to-teal-600","bg-gradient-to-br from-orange-500 to-red-600","bg-gradient-to-br from-pink-500 to-rose-600","bg-gradient-to-br from-indigo-500 to-blue-600"],r=i[Math.floor(Math.random()*i.length)];return e.jsxs("div",{className:`${r} rounded-lg p-4 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full -translate-y-10 translate-x-10"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-16 h-16 bg-white/10 rounded-full translate-y-8 -translate-x-8"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"bg-white/20 px-2 py-1 rounded-full",children:e.jsx("span",{className:"text-xs font-medium",children:"promo"===t.type?"PROMOCI√ìN":"PUBLICIDAD"})}),t.ad_type&&"promo"!==t.ad_type&&e.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium "+("premium"===t.ad_type?"bg-yellow-400/30 text-yellow-200":"bg-blue-400/30 text-blue-200"),children:"premium"===t.ad_type?"‚≠ê PREMIUM":"üì¢ EST√ÅNDAR"})]}),e.jsx(k,{className:"w-4 h-4 opacity-70"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-bold text-lg mb-1",children:t.title||"Anuncio"}),e.jsx("p",{className:"text-white/90 text-sm mb-2",children:t.description||"Descripci√≥n del anuncio"}),t.company_info&&e.jsx("p",{className:"text-white/80 text-xs",children:t.company_info}),t.price&&e.jsxs("p",{className:"text-white/80 text-xs font-bold",children:["$",t.price," USD"]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:"promo"===t.type?"VIP"===t.promo_type?e.jsxs(o,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a(),children:[e.jsx("span",{children:"üöÄ"}),"Obtener VIP"]}):"AUTOMARKET"===t.promo_type?e.jsxs(o,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a(),children:[e.jsx(S,{className:"w-3 h-3 mr-1"}),"Ver AutoMarket"]}):null:e.jsxs(e.Fragment,{children:[t.contact_phone&&e.jsxs(o,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a("phone",t.contact_phone),children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),"Llamar"]}),t.contact_email&&e.jsxs(o,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a("email",t.contact_email),children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Email"]}),t.contact_website&&e.jsxs(o,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a("website",t.contact_website),children:[e.jsx(S,{className:"w-3 h-3 mr-1"}),"Web"]}),t.contact_whatsapp&&e.jsxs(o,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a("whatsapp",t.contact_whatsapp),children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"WhatsApp"]})]})})]})]})},de=m.forwardRef((t,s)=>{const{user:a}=n(),{toast:i}=c(),r=O(),[l,o]=m.useState([]),[h,k]=m.useState([]),[S,C]=m.useState([]),[P,z]=m.useState(!0),[V,D]=m.useState(!1),[$,U]=m.useState(null),[F,q]=m.useState(null),[B,K]=m.useState(!1),[W,H]=m.useState(!1),[Y,G]=m.useState({}),J=m.useCallback(async()=>{var e;if(null==a?void 0:a.uid)try{z(!0);const s=x(d,"posts"),i=f(s,g("created_at","desc"),w(12)),r=await b(i),l=await Promise.all(r.docs.map(async e=>{const t={id:e.id,...e.data()};try{const e=v(d,"profiles",t.user_id),s=await j(e);s.exists()&&(t.author={id:s.id,...s.data()})}catch(s){}try{const e=x(d,"post_likes"),s=f(e,y("post_id","==",t.id)),i=await b(s);t.likes=i.docs.map(e=>({id:e.id,...e.data()})),t.likes_count=t.likes.length,t.is_liked=t.likes.some(e=>e.user_id===a.uid)}catch(s){t.likes=[],t.likes_count=0,t.is_liked=!1}return t})),n={};for(const o of l)if(null==(e=o.author)?void 0:e.id)try{const e=x(d,"user_likes"),t=f(e,y("user_id","==",a.uid),y("liked_user_id","==",o.author.id)),s=await b(t);n[o.author.id]=s.size>0}catch(t){n[o.author.id]=!1}G(n);const c=x(d,"advertisements"),u=f(c,y("status","==","active"),w(6));let p=(await b(u)).docs.map(e=>({id:e.id,...e.data(),type:"ad",source:"advertising_portal"}));const m=[{id:"banner-vip",type:"promo",title:"Obten√© VIP",description:"Tu perfil destacado por 30 d√≠as",image_url:"/pwa-512x512.png",price:15,promo_type:"VIP",ad_type:"promo"},{id:"banner-automarket",title:"AutoMarket",description:"Compra y venta de autos",type:"promo",image_url:"/pwa-512x512.png",website:"https://auto-market.pro",promo_type:"AUTOMARKET",ad_type:"promo"}];p=[...p,...m],o(l),k(p);const h=[];let N=0;if(0===l.length)h.push(...p);else{for(let e=0;e<l.length;e+=6){const t=l.slice(e,e+6);if(h.push(...t),N<p.length){const e=p.slice(N,N+2);h.push(...e),N+=2}}if(N<p.length){const e=p.slice(N);h.push(...e)}}C(h)}catch(t){C([])}finally{z(!1)}else z(!1)},[null==a?void 0:a.uid,i]);m.useEffect(()=>{J()},[J]);const Q=(e,t,s)=>{switch(e){case"message":U(t),K(!0);break;case"profile":r(`/profile/${t.id}`);break;case"view":r(`/post/${s.id}`)}},X=async()=>{D(!0),await J(),D(!1)};return m.useImperativeHandle(s,()=>({handleRefresh:X})),P&&0===S.length?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(E,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary"}),e.jsx("p",{className:"text-text-secondary",children:"Cargando publicaciones..."})]})}):0!==S.length||P?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-2 gap-4",children:S.map((t,s)=>{var l,o,n,c,p;const m=t.template_id?u(t.template_id):null,h=t.text_color||(null==m?void 0:m.defaultTextColor)||"#f5f5f5";return e.jsx("div",{className:"relative",children:"ad"===t.type||"promo"===t.type?e.jsx(ce,{ad:t}):e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"card-glass rounded-lg overflow-hidden cursor-pointer",children:[e.jsxs("div",{className:"absolute top-2 right-2 z-20",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),q(t),H((null==F?void 0:F.id)!==t.id)},className:"bg-black/50 rounded-full p-1 text-white hover:bg-black/70 transition-colors",children:e.jsx(I,{className:"w-4 h-4"})}),W&&(null==F?void 0:F.id)===t.id&&e.jsxs("div",{className:"absolute top-8 right-0 z-40 bg-white/95 backdrop-blur-sm rounded-lg shadow-lg border border-gray-200 py-1 min-w-[160px]",children:[e.jsxs("button",{onClick:e=>{e.stopPropagation(),H(!1),Q("message",F.author,F),q(null)},className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-blue-50 transition-colors text-left",children:[e.jsx(L,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"üìß Mensaje"})]}),e.jsxs("button",{onClick:e=>{e.stopPropagation(),H(!1),Q("profile",F.author,F),q(null)},className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-green-50 transition-colors text-left",children:[e.jsx(R,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-700 font-medium",children:"üë§ Ver perfil"})]}),e.jsxs("button",{onClick:e=>{e.stopPropagation(),H(!1),Q("view",F.author,F),q(null)},className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-purple-50 transition-colors text-left",children:[e.jsx(M,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm text-purple-700 font-medium",children:"üëÅÔ∏è Ver post"})]})]})]}),e.jsx("div",{onClick:()=>r(`/post/${t.id}`),className:"aspect-square relative cursor-pointer",children:t.image_url?e.jsx("img",{src:t.image_url,alt:"Post",className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}):t.video_url?e.jsx("video",{src:t.video_url,className:"w-full h-full object-cover",preload:"metadata",playsInline:!0,muted:!0}):m?e.jsx("div",{className:"w-full h-full flex items-center justify-center text-center p-4",style:{background:m.background,color:h},children:e.jsx("p",{className:"text-lg font-semibold whitespace-pre-wrap break-words",children:t.text||"Publicaci√≥n de texto"})}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-slate-800/60 text-white p-4 text-center",children:e.jsx("p",{className:"text-base font-medium whitespace-pre-wrap break-words line-clamp-6",children:t.text||"Publicaci√≥n"})})}),e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("img",{src:(null==(l=t.author)?void 0:l.profile_picture_url)||"/pwa-512x512.png",alt:null==(o=t.author)?void 0:o.alias,className:"w-6 h-6 rounded-full object-cover",loading:"lazy",decoding:"async"}),e.jsx("span",{className:"text-sm font-medium",children:null==(n=t.author)?void 0:n.alias})]}),t.text&&!m&&e.jsx("p",{className:"text-sm text-gray-700 mb-2 line-clamp-2",children:t.text}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:e=>{e.stopPropagation(),(async e=>{if(null==a?void 0:a.uid)try{const t=x(d,"post_likes"),s=f(t,y("post_id","==",e),y("user_id","==",a.uid)),r=await b(s);if(r.empty)await N(t,{post_id:e,user_id:a.uid,created_at:(new Date).toISOString()}),i({title:"‚ù§Ô∏è Like agregado",description:"Tu like ha sido registrado"});else{const e=r.docs[0];await _(v(d,"post_likes",e.id)),i({title:"üíî Like removido",description:"Tu like ha sido removido"})}J()}catch(t){i({variant:"destructive",title:"Error",description:"No se pudo procesar el like"})}})(t.id)},className:`flex items-center gap-1 ${t.is_liked?"text-red-500":"text-gray-400"} hover:text-red-500 transition-colors`,children:[e.jsx(T,{className:"w-4 h-4 "+(t.is_liked?"fill-current":"")}),e.jsx("span",{className:"text-xs",children:t.likes_count})]}),e.jsx("button",{onClick:e=>{var s;e.stopPropagation(),(async e=>{if((null==a?void 0:a.uid)&&e)try{if(Y[e]){const t=x(d,"user_likes"),s=f(t,y("user_id","==",a.uid),y("liked_user_id","==",e)),r=await b(s);for(const e of r.docs)await _(v(d,"user_likes",e.id));G(t=>({...t,[e]:!1})),i({title:"Dejaste de seguir",description:"Ya no sigues a este usuario"})}else await N(x(d,"user_likes"),{user_id:a.uid,liked_user_id:e,created_at:(new Date).toISOString()}),G(t=>({...t,[e]:!0})),i({title:"¬°Siguiendo!",description:"Ahora sigues a este usuario"});J()}catch(t){i({variant:"destructive",title:"Error",description:"No se pudo procesar la acci√≥n"})}})(null==(s=t.author)?void 0:s.id)},className:"text-xs px-2 py-1 rounded-full transition-colors "+(Y[null==(c=t.author)?void 0:c.id]?"bg-red-500 text-white hover:bg-red-600":"bg-green-500 text-white hover:bg-green-600"),children:Y[null==(p=t.author)?void 0:p.id]?"Siguiendo":"Seguir"})]})]})]})})},t.id||s)})}),P&&S.length>0&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(E,{className:"w-6 h-6 animate-spin text-primary"})}),$&&e.jsx(p,{profile:$,onClose:()=>{K(!1),U(null)}})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(A,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No hay publicaciones"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"S√© el primero en compartir algo"}),e.jsx(CreatePost,{})]})});de.displayName="PublicationsFeed";export{de as default};
