import{u as s,a as e,d as a,j as t,B as i}from"./index-CsVzbaqs.js";import{r}from"./vendor-npDLdgAy.js";import{m as l,q as o,p as d,r as c,d as n,c as u,w as p}from"./firebase-eG8A_CqU.js";import{u as m}from"./router-Ba8Cb_LR.js";import{a7 as x,_ as f,D as h}from"./ui-BzcIgpI6.js";const v=()=>{const{user:v}=s(),{toast:j}=e(),w=m(),[b,y]=r.useState([]),[N,g]=r.useState(!0),k=r.useCallback(async()=>{try{g(!0);const s=l(a,"profiles"),e=o(s,d(10)),t=(await c(e)).docs.map(s=>({id:s.id,...s.data(),type:"vip"})),i=l(a,"stories"),r=o(i,d(8)),m=await c(r),x=await Promise.all(m.docs.map(async s=>{const e={id:s.id,...s.data(),type:"story"};try{const s=n(a,"profiles",e.user_id),t=await u(s);t.exists()&&(e.author={id:t.id,...t.data()})}catch(t){}return e})),f=l(a,"advertisements"),h=o(f,p("status","==","active"),p("ad_plan","==","premium"),d(4)),v=(await c(h)).docs.map(s=>({id:s.id,...s.data(),type:"ad",source:"advertising_portal"})),j=[];let w=0;const b=[...t,...x];for(let a=0;a<b.length;a+=6){const s=b.slice(a,a+6);if(j.push(...s),w<v.length){const s=v.slice(w,w+2);j.push(...s),w+=2}}y(j)}catch(s){y([])}finally{g(!1)}},[j]);r.useEffect(()=>{(null==v?void 0:v.uid)&&k()},[null==v?void 0:v.uid,k]);return N?t.jsx("div",{className:"px-4 py-2",children:t.jsx("div",{className:"flex gap-3 overflow-x-auto",children:[1,2,3,4,5].map(s=>t.jsx("div",{className:"flex-shrink-0 w-16 h-16 bg-muted rounded-full animate-pulse"},s))})}):t.jsx("div",{className:"px-4 py-2",children:t.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-2",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsxs(i,{variant:"outline",size:"sm",className:"w-16 h-16 rounded-full flex flex-col items-center justify-center gap-1 bg-muted/50 hover:bg-muted",onClick:()=>w("/my-profile"),children:[t.jsx(x,{className:"w-6 h-6"}),t.jsx("span",{className:"text-xs",children:"Tu historia"})]})}),b.map((s,e)=>{var a,i;return t.jsxs("div",{className:"flex-shrink-0",children:[t.jsx("button",{onClick:()=>(s=>{switch(s.type){case"vip":w(`/profile/${s.id}`);break;case"story":j({title:"Historia",description:"Funcionalidad de historias en desarrollo."});break;case"ad":s.website&&window.open(s.website,"_blank")}})(s),className:"w-16 h-16 rounded-full relative overflow-hidden border-2 border-transparent hover:border-primary transition-colors",children:"ad"===s.type?t.jsx("div",{className:"w-full h-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:t.jsx(f,{className:"w-8 h-8 text-white"})}):t.jsxs("div",{className:"relative w-full h-full",children:[t.jsx("img",{src:s.profile_picture_url||s.media_url||"/pwa-512x512.png",alt:s.alias||(null==(a=s.author)?void 0:a.alias)||"Usuario",className:"w-full h-full object-cover",onError:s=>{s.target.src="/pwa-512x512.png"}}),s.is_vip&&t.jsx("div",{className:"absolute -top-1 -right-1",children:t.jsx(h,{className:"w-4 h-4 text-yellow-500 fill-current"})}),"story"===s.type&&t.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"})]})}),t.jsx("div",{className:"text-center mt-1",children:t.jsx("span",{className:"text-xs text-muted-foreground truncate w-16 block",children:"ad"===s.type?"Publicidad":s.alias||(null==(i=s.author)?void 0:i.alias)||"Usuario"})})]},`${s.type}-${s.id}`)})]})})};export{v as default};
