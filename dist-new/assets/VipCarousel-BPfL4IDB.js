import{u as e,a,d as s,j as t,B as r}from"./index-CZejSxFf.js";import{r as i}from"./vendor-npDLdgAy.js";import{m as l,q as o,n as d,p as c,r as n,w as u,d as p,c as m}from"./firebase-eG8A_CqU.js";import{u as x}from"./router-Ba8Cb_LR.js";import{a7 as f,_ as h,D as v}from"./ui-BzcIgpI6.js";const w=()=>{const{user:w}=e(),{toast:j}=a(),b=x(),[y,N]=i.useState([]),[g,_]=i.useState(!0),k=i.useCallback(async()=>{try{_(!0);const e=l(s,"profiles"),a=o(e,d("created_at","desc"),c(10)),t=(await n(a)).docs.map(e=>({id:e.id,...e.data(),type:"vip"})),r=l(s,"stories"),i=new Date(Date.now()-864e5),x=o(r,u("created_at",">",i),d("created_at","desc"),c(8)),f=await n(x),h=await Promise.all(f.docs.map(async e=>{const a={id:e.id,...e.data(),type:"story"};try{const e=p(s,"profiles",a.user_id),t=await m(e);t.exists()&&(a.author={id:t.id,...t.data()})}catch(t){}return a})),v=l(s,"advertisements"),w=o(v,u("status","==","active"),u("ad_plan","==","premium"),d("created_at","desc"),c(4)),j=(await n(w)).docs.map(e=>({id:e.id,...e.data(),type:"ad",source:"advertising_portal"})),b=[];let y=0;const g=[...t,...h];for(let s=0;s<g.length;s+=6){const e=g.slice(s,s+6);if(b.push(...e),y<j.length){const e=j.slice(y,y+2);b.push(...e),y+=2}}N(b)}catch(e){N([])}finally{_(!1)}},[j]);i.useEffect(()=>{(null==w?void 0:w.uid)&&k()},[null==w?void 0:w.uid,k]);return g?t.jsx("div",{className:"px-4 py-2",children:t.jsx("div",{className:"flex gap-3 overflow-x-auto",children:[1,2,3,4,5].map(e=>t.jsx("div",{className:"flex-shrink-0 w-16 h-16 bg-muted rounded-full animate-pulse"},e))})}):t.jsx("div",{className:"px-4 py-2",children:t.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-2",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsxs(r,{variant:"outline",size:"sm",className:"w-16 h-16 rounded-full flex flex-col items-center justify-center gap-1 bg-muted/50 hover:bg-muted",onClick:()=>b("/my-profile"),children:[t.jsx(f,{className:"w-6 h-6"}),t.jsx("span",{className:"text-xs",children:"Tu historia"})]})}),y.map((e,a)=>{var s,r;return t.jsxs("div",{className:"flex-shrink-0",children:[t.jsx("button",{onClick:()=>(e=>{switch(e.type){case"vip":b(`/profile/${e.id}`);break;case"story":j({title:"Historia",description:"Funcionalidad de historias en desarrollo."});break;case"ad":e.website&&window.open(e.website,"_blank")}})(e),className:"w-16 h-16 rounded-full relative overflow-hidden border-2 border-transparent hover:border-primary transition-colors",children:"ad"===e.type?t.jsx("div",{className:"w-full h-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:t.jsx(h,{className:"w-8 h-8 text-white"})}):t.jsxs("div",{className:"relative w-full h-full",children:[t.jsx("img",{src:e.profile_picture_url||e.media_url||"/pwa-512x512.png",alt:e.alias||(null==(s=e.author)?void 0:s.alias)||"Usuario",className:"w-full h-full object-cover",onError:e=>{e.target.src="/pwa-512x512.png"}}),e.is_vip&&t.jsx("div",{className:"absolute -top-1 -right-1",children:t.jsx(v,{className:"w-4 h-4 text-yellow-500 fill-current"})}),"story"===e.type&&t.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"})]})}),t.jsx("div",{className:"text-center mt-1",children:t.jsx("span",{className:"text-xs text-muted-foreground truncate w-16 block",children:"ad"===e.type?"Publicidad":e.alias||(null==(r=e.author)?void 0:r.alias)||"Usuario"})})]},`${e.type}-${e.id}`)})]})})};export{w as default};
