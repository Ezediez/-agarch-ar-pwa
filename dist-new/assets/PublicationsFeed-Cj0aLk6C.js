import{j as e,c as t,P as a,b as s,e as r,f as i,a as o,B as l,u as n,d as c,D as d}from"./index-Dwzp2ic0.js";import{r as m,R as u}from"./vendor-npDLdgAy.js";import{m as p,q as x,n as h,p as f,r as g,d as w,c as v,w as b,z as j}from"./firebase-eG8A_CqU.js";import y from"./CreatePost-RBNUOyo7.js";import{ag as N,ah as _,ai as k,$ as S,L as C,_ as E,R as A,aj as P,H as L}from"./ui-BcaUMzZJ.js";import{u as I}from"./router-Ba8Cb_LR.js";var R={exports:{}},M={},T=m;var O="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},D=T.useState,V=T.useEffect,z=T.useLayoutEffect,$=T.useDebugValue;function U(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!O(e,a)}catch(s){return!0}}var q="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var a=t(),s=D({inst:{value:a,getSnapshot:t}}),r=s[0].inst,i=s[1];return z(function(){r.value=a,r.getSnapshot=t,U(r)&&i({inst:r})},[e,a,t]),V(function(){return U(r)&&i({inst:r}),e(function(){U(r)&&i({inst:r})})},[e]),$(a),a};M.useSyncExternalStore=void 0!==T.useSyncExternalStore?T.useSyncExternalStore:q,R.exports=M;var B=R.exports;function F(){return()=>{}}var K="Avatar",[W,H]=t(K),[G,J]=W(K),Q=m.forwardRef((t,s)=>{const{__scopeAvatar:r,...i}=t,[o,l]=m.useState("idle");return e.jsx(G,{scope:r,imageLoadingStatus:o,onImageLoadingStatusChange:l,children:e.jsx(a.span,{...i,ref:s})})});Q.displayName=K;var X="AvatarImage",Y=m.forwardRef((t,i)=>{const{__scopeAvatar:o,src:l,onLoadingStatusChange:n=()=>{},...c}=t,d=J(X,o),u=function(e,{referrerPolicy:t,crossOrigin:a}){const s=B.useSyncExternalStore(F,()=>!0,()=>!1),i=m.useRef(null),o=s?(i.current||(i.current=new window.Image),i.current):null,[l,n]=m.useState(()=>te(o,e));return r(()=>{n(te(o,e))},[o,e]),r(()=>{const e=e=>()=>{n(e)};if(!o)return;const s=e("loaded"),r=e("error");return o.addEventListener("load",s),o.addEventListener("error",r),t&&(o.referrerPolicy=t),"string"==typeof a&&(o.crossOrigin=a),()=>{o.removeEventListener("load",s),o.removeEventListener("error",r)}},[o,a,t]),l}(l,c),p=s(e=>{n(e),d.onImageLoadingStatusChange(e)});return r(()=>{"idle"!==u&&p(u)},[u,p]),"loaded"===u?e.jsx(a.img,{...c,ref:i,src:l}):null});Y.displayName=X;var Z="AvatarFallback",ee=m.forwardRef((t,s)=>{const{__scopeAvatar:r,delayMs:i,...o}=t,l=J(Z,r),[n,c]=m.useState(void 0===i);return m.useEffect(()=>{if(void 0!==i){const e=window.setTimeout(()=>c(!0),i);return()=>window.clearTimeout(e)}},[i]),n&&"loaded"!==l.imageLoadingStatus?e.jsx(a.span,{...o,ref:s}):null});function te(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}ee.displayName=Z;var ae=Q,se=Y,re=ee;u.forwardRef(({className:t,...a},s)=>e.jsx(ae,{ref:s,className:i("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...a})).displayName=ae.displayName;u.forwardRef(({className:t,...a},s)=>e.jsx(se,{ref:s,className:i("aspect-square h-full w-full",t),...a})).displayName=se.displayName;u.forwardRef(({className:t,...a},s)=>e.jsx(re,{ref:s,className:i("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...a})).displayName=re.displayName;const ie=({ad:t})=>{const{toast:a}=o(),s=(e,s)=>{if("promo"!==t.type)a({title:"‚ö†Ô∏è Salir de la app",description:"Est√°s saliendo de la aplicaci√≥n para contactar al anunciante.",duration:3e3}),setTimeout(()=>{switch(e){case"contact_phone":window.location.href=`tel:${s}`;break;case"contact.email":window.location.href=`mailto:${s}`;break;case"website":window.open(s,"_blank");break;case"whatsapp":window.open(`https://wa.me/${s.replace(/[^0-9]/g,"")}`,"_blank")}},1500);else switch(t.promo_type){case"VIP":a({title:"üéØ VIP - Funcionalidad en desarrollo",description:"Muy pronto podr√°s obtener VIP para destacar tu perfil.",duration:3e3});break;case"AUTOMARKET":window.open(t.website,"_blank")}},r=["bg-gradient-to-br from-blue-500 to-purple-600","bg-gradient-to-br from-green-500 to-teal-600","bg-gradient-to-br from-orange-500 to-red-600","bg-gradient-to-br from-pink-500 to-rose-600","bg-gradient-to-br from-indigo-500 to-blue-600"],i=r[Math.floor(Math.random()*r.length)];return e.jsxs("div",{className:`${i} rounded-lg p-4 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full -translate-y-10 translate-x-10"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-16 h-16 bg-white/10 rounded-full translate-y-8 -translate-x-8"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"bg-white/20 px-2 py-1 rounded-full",children:e.jsx("span",{className:"text-xs font-medium",children:"promo"===t.type?"PROMOCI√ìN":"PUBLICIDAD"})}),t.ad_type&&"promo"!==t.ad_type&&e.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium "+("premium"===t.ad_type?"bg-yellow-400/30 text-yellow-200":"bg-blue-400/30 text-blue-200"),children:"premium"===t.ad_type?"‚≠ê PREMIUM":"üì¢ EST√ÅNDAR"})]}),e.jsx(N,{className:"w-4 h-4 opacity-70"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-bold text-lg mb-1",children:t.title||"Anuncio"}),e.jsx("p",{className:"text-white/90 text-sm mb-2",children:t.description||"Descripci√≥n del anuncio"}),t.company_info&&e.jsx("p",{className:"text-white/80 text-xs",children:t.company_info}),t.price&&e.jsxs("p",{className:"text-white/80 text-xs font-bold",children:["$",t.price," USD"]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:"promo"===t.type?"VIP"===t.promo_type?e.jsxs(l,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>s(),children:[e.jsx("span",{children:"üöÄ"}),"Obtener VIP"]}):"AUTOMARKET"===t.promo_type?e.jsxs(l,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>s(),children:[e.jsx(_,{className:"w-3 h-3 mr-1"}),"Ver AutoMarket"]}):null:e.jsxs(e.Fragment,{children:[t.contact_phone&&e.jsxs(l,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>s("phone",t.contact_phone),children:[e.jsx(k,{className:"w-3 h-3 mr-1"}),"Llamar"]}),t.contact_email&&e.jsxs(l,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>s("email",t.contact_email),children:[e.jsx(S,{className:"w-3 h-3 mr-1"}),"Email"]}),t.contact_website&&e.jsxs(l,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>s("website",t.contact_website),children:[e.jsx(_,{className:"w-3 h-3 mr-1"}),"Web"]}),t.contact_whatsapp&&e.jsxs(l,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>s("whatsapp",t.contact_whatsapp),children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"WhatsApp"]})]})})]})]})},oe=()=>{const{user:t}=n(),{toast:a}=o(),s=I(),[r,i]=m.useState([]),[l,u]=m.useState([]),[N,_]=m.useState([]),[k,S]=m.useState(!0),[R,M]=m.useState(!1),[T,O]=m.useState(null),[D,V]=m.useState(!1),z=m.useCallback(async()=>{if(null==t?void 0:t.uid)try{S(!0);const e=p(c,"posts"),a=x(e,h("created_at","desc"),f(20)),s=await g(a),r=await Promise.all(s.docs.map(async e=>{const a={id:e.id,...e.data()};try{const e=w(c,"profiles",a.user_id),t=await v(e);t.exists()&&(a.author={id:t.id,...t.data()})}catch(s){}try{const e=p(c,"post_likes"),s=x(e,b("post_id","==",a.id)),r=await g(s);a.likes=r.docs.map(e=>({id:e.id,...e.data()})),a.likes_count=a.likes.length,a.is_liked=a.likes.some(e=>e.user_id===t.uid)}catch(s){a.likes=[],a.likes_count=0,a.is_liked=!1}return a})),o=p(c,"advertisements"),l=x(o,b("status","==","active"),f(10));let n=(await g(l)).docs.map(e=>({id:e.id,...e.data(),type:"ad",source:"advertising_portal"}));const d=[{id:"banner-vip",type:"promo",title:"Obten√© VIP",description:"Tu perfil destacado por 30 d√≠as",image_url:"/pwa-512x512.png",price:15,promo_type:"VIP",ad_type:"promo"},{id:"banner-automarket",title:"AutoMarket",description:"Compra y venta de autos",type:"promo",image_url:"/pwa-512x512.png",website:"https://auto-market.pro",promo_type:"AUTOMARKET",ad_type:"promo"}];n=[...n,...d],i(r),u(n);const m=[];let j=0;if(0===r.length)m.push(...n);else{for(let e=0;e<r.length;e+=6){const t=r.slice(e,e+6);if(m.push(...t),j<n.length){const e=n.slice(j,j+2);m.push(...e),j+=2}}if(j<n.length){const e=n.slice(j);m.push(...e)}}_(m)}catch(e){_([])}finally{S(!1)}else S(!1)},[null==t?void 0:t.uid,a]);m.useEffect(()=>{z()},[z]);return k&&0===N.length?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(C,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary"}),e.jsx("p",{className:"text-text-secondary",children:"Cargando publicaciones..."})]})}):0!==N.length||k?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-primary",children:"Descubrir"}),e.jsx("button",{onClick:async()=>{M(!0),await z(),M(!1)},disabled:R,className:"p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors",children:e.jsx(A,{className:"w-5 h-5 "+(R?"animate-spin":"")})})]}),e.jsx(y,{}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:N.map((r,i)=>{var o,l,n;return e.jsx("div",{className:"relative",children:"ad"===r.type||"promo"===r.type?e.jsx(ie,{ad:r}):e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"card-glass rounded-lg overflow-hidden cursor-pointer",onClick:()=>s(`/post/${r.id}`),children:[r.image_url&&e.jsx("div",{className:"aspect-square relative",children:e.jsx("img",{src:r.image_url,alt:"Post",className:"w-full h-full object-cover"})}),r.video_url&&e.jsx("div",{className:"aspect-square relative",children:e.jsx("video",{src:r.video_url,className:"w-full h-full object-cover",muted:!0})}),e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:(null==(o=r.author)?void 0:o.profile_picture_url)||"/pwa-512x512.png",alt:null==(l=r.author)?void 0:l.alias,className:"w-6 h-6 rounded-full object-cover"}),e.jsx("span",{className:"text-sm font-medium",children:null==(n=r.author)?void 0:n.alias})]}),e.jsx("button",{onClick:e=>{var t;e.stopPropagation(),t=r.author,O(t),V(!0)},className:"text-gray-400 hover:text-gray-600",children:e.jsx(P,{className:"w-4 h-4"})})]}),r.text&&e.jsx("p",{className:"text-sm text-gray-700 mb-2 line-clamp-2",children:r.text}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:e=>{e.stopPropagation(),(async e=>{if(null==t?void 0:t.uid)try{const s=p(c,"post_likes"),r=x(s,b("post_id","==",e),b("user_id","==",t.uid)),i=await g(r);i.empty?(await j(s,{post_id:e,user_id:t.uid,created_at:new Date}),a({title:"‚ù§Ô∏è Like agregado",description:"Tu like ha sido registrado"})):(i.docs[0],await j(p(c,"post_likes"),{post_id:e,user_id:t.uid,created_at:new Date,action:"unlike"}),a({title:"üíî Like removido",description:"Tu like ha sido removido"})),z()}catch(s){a({variant:"destructive",title:"Error",description:"No se pudo procesar el like"})}})(r.id)},className:`flex items-center gap-1 ${r.is_liked?"text-red-500":"text-gray-400"} hover:text-red-500 transition-colors`,children:[e.jsx(L,{className:"w-4 h-4 "+(r.is_liked?"fill-current":"")}),e.jsx("span",{className:"text-xs",children:r.likes_count})]})})]})]})})},r.id||i)})}),k&&N.length>0&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(C,{className:"w-6 h-6 animate-spin text-primary"})}),T&&e.jsx(d,{profile:T,onClose:()=>{V(!1),O(null)}})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No hay publicaciones"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"S√© el primero en compartir algo"}),e.jsx(y,{})]})};export{oe as default};
