import{r as e,t,g as a,l as s,b as r,j as i,c as n,P as o,e as l,f as c,h as d,u,a as m,d as p,B as x,i as h,T as f}from"./index-BlzT50JC.js";import{r as v,R as w}from"./vendor-npDLdgAy.js";import{m as g,q as b,n as j,w as y,r as N,d as _,c as S,z as k,e as D,p as M}from"./firebase-eG8A_CqU.js";import{X as C,u as E,m as T,ag as I,ah as A,H as P,s as L,ai as R,aj as O,ak as z,$ as X,L as V,_ as U,R as F}from"./ui-BvOHhki7.js";import{u as Y}from"./router-Ba8Cb_LR.js";import $ from"./CreatePost-fvlbJtSn.js";function H(a,s){e(2,arguments);var r=t(a),i=t(s),n=r.getTime()-i.getTime();return n<0?-1:n>0?1:n}var K={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(e){return e<0?Math.ceil(e):Math.floor(e)}};function q(a){e(1,arguments);var s=t(a);return function(a){e(1,arguments);var s=t(a);return s.setHours(23,59,59,999),s}(s).getTime()===function(a){e(1,arguments);var s=t(a),r=s.getMonth();return s.setFullYear(s.getFullYear(),r+1,0),s.setHours(23,59,59,999),s}(s).getTime()}function B(a,s){e(2,arguments);var r,i=t(a),n=t(s),o=H(i,n),l=Math.abs(function(a,s){e(2,arguments);var r=t(a),i=t(s);return 12*(r.getFullYear()-i.getFullYear())+(r.getMonth()-i.getMonth())}(i,n));if(l<1)r=0;else{1===i.getMonth()&&i.getDate()>27&&i.setDate(30),i.setMonth(i.getMonth()-o*l);var c=H(i,n)===-o;q(t(a))&&1===l&&1===H(a,n)&&(c=!1),r=o*(l-Number(c))}return 0===r?0:r}function W(a,s,r){e(2,arguments);var i=function(a,s){return e(2,arguments),t(a).getTime()-t(s).getTime()}(a,s)/1e3;return K.trunc(i)}function G(e,t){if(null==e)throw new TypeError("assign requires that input parameter not be null or undefined");for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}var J=43200;function Q(i,n,o){var l,c;e(2,arguments);var d=a(),u=null!==(l=null!==(c=null==o?void 0:o.locale)&&void 0!==c?c:d.locale)&&void 0!==l?l:s;if(!u.formatDistance)throw new RangeError("locale must contain formatDistance property");var m=H(i,n);if(isNaN(m))throw new RangeError("Invalid time value");var p,x,h=G(G({},o),{addSuffix:Boolean(null==o?void 0:o.addSuffix),comparison:m});m>0?(p=t(n),x=t(i)):(p=t(i),x=t(n));var f,v=W(x,p),w=(r(x)-r(p))/1e3,g=Math.round((v-w)/60);if(g<2)return null!=o&&o.includeSeconds?v<5?u.formatDistance("lessThanXSeconds",5,h):v<10?u.formatDistance("lessThanXSeconds",10,h):v<20?u.formatDistance("lessThanXSeconds",20,h):v<40?u.formatDistance("halfAMinute",0,h):v<60?u.formatDistance("lessThanXMinutes",1,h):u.formatDistance("xMinutes",1,h):0===g?u.formatDistance("lessThanXMinutes",1,h):u.formatDistance("xMinutes",g,h);if(g<45)return u.formatDistance("xMinutes",g,h);if(g<90)return u.formatDistance("aboutXHours",1,h);if(g<1440){var b=Math.round(g/60);return u.formatDistance("aboutXHours",b,h)}if(g<2520)return u.formatDistance("xDays",1,h);if(g<J){var j=Math.round(g/1440);return u.formatDistance("xDays",j,h)}if(g<86400)return f=Math.round(g/J),u.formatDistance("aboutXMonths",f,h);if((f=B(x,p))<12){var y=Math.round(g/J);return u.formatDistance("xMonths",y,h)}var N=f%12,_=Math.floor(f/12);return N<3?u.formatDistance("aboutXYears",_,h):N<9?u.formatDistance("overXYears",_,h):u.formatDistance("almostXYears",_+1,h)}function Z(t,a){return e(1,arguments),Q(t,Date.now(),a)}var ee={exports:{}},te={},ae=v;var se="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},re=ae.useState,ie=ae.useEffect,ne=ae.useLayoutEffect,oe=ae.useDebugValue;function le(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!se(e,a)}catch(s){return!0}}var ce="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var a=t(),s=re({inst:{value:a,getSnapshot:t}}),r=s[0].inst,i=s[1];return ne(function(){r.value=a,r.getSnapshot=t,le(r)&&i({inst:r})},[e,a,t]),ie(function(){return le(r)&&i({inst:r}),e(function(){le(r)&&i({inst:r})})},[e]),oe(a),a};te.useSyncExternalStore=void 0!==ae.useSyncExternalStore?ae.useSyncExternalStore:ce,ee.exports=te;var de=ee.exports;function ue(){return()=>{}}var me="Avatar",[pe,xe]=n(me),[he,fe]=pe(me),ve=v.forwardRef((e,t)=>{const{__scopeAvatar:a,...s}=e,[r,n]=v.useState("idle");return i.jsx(he,{scope:a,imageLoadingStatus:r,onImageLoadingStatusChange:n,children:i.jsx(o.span,{...s,ref:t})})});ve.displayName=me;var we="AvatarImage",ge=v.forwardRef((e,t)=>{const{__scopeAvatar:a,src:s,onLoadingStatusChange:r=()=>{},...n}=e,d=fe(we,a),u=function(e,{referrerPolicy:t,crossOrigin:a}){const s=de.useSyncExternalStore(ue,()=>!0,()=>!1),r=v.useRef(null),i=s?(r.current||(r.current=new window.Image),r.current):null,[n,o]=v.useState(()=>ye(i,e));return c(()=>{o(ye(i,e))},[i,e]),c(()=>{const e=e=>()=>{o(e)};if(!i)return;const s=e("loaded"),r=e("error");return i.addEventListener("load",s),i.addEventListener("error",r),t&&(i.referrerPolicy=t),"string"==typeof a&&(i.crossOrigin=a),()=>{i.removeEventListener("load",s),i.removeEventListener("error",r)}},[i,a,t]),n}(s,n),m=l(e=>{r(e),d.onImageLoadingStatusChange(e)});return c(()=>{"idle"!==u&&m(u)},[u,m]),"loaded"===u?i.jsx(o.img,{...n,ref:t,src:s}):null});ge.displayName=we;var be="AvatarFallback",je=v.forwardRef((e,t)=>{const{__scopeAvatar:a,delayMs:s,...r}=e,n=fe(be,a),[l,c]=v.useState(void 0===s);return v.useEffect(()=>{if(void 0!==s){const e=window.setTimeout(()=>c(!0),s);return()=>window.clearTimeout(e)}},[s]),l&&"loaded"!==n.imageLoadingStatus?i.jsx(o.span,{...r,ref:t}):null});function ye(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}je.displayName=be;var Ne=ve,_e=ge,Se=je;const ke=w.forwardRef(({className:e,...t},a)=>i.jsx(Ne,{ref:a,className:d("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));ke.displayName=Ne.displayName;const De=w.forwardRef(({className:e,...t},a)=>i.jsx(_e,{ref:a,className:d("aspect-square h-full w-full",e),...t}));De.displayName=_e.displayName;const Me=w.forwardRef(({className:e,...t},a)=>i.jsx(Se,{ref:a,className:d("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));Me.displayName=Se.displayName;const Ce=({postId:e,onClose:t,commentsCount:a})=>{var s;const[r,n]=v.useState([]),[o,l]=v.useState(""),[c,d]=v.useState(!0),[w,D]=v.useState(!1),[M,T]=v.useState(a),{user:I,profile:A}=u(),{toast:P}=m(),L=v.useRef(null),R=v.useCallback(async()=>{d(!0);const t=g(p,"comentarios"),a=b(t,y("publicacion_id","==",e),j("creado_en","asc")),s=(await N(a)).docs.map(e=>({id:e.id,...e.data()})),r=await Promise.all(s.map(async e=>{try{const t=_(p,"profiles",e.usuario_id),a=await S(t),s=a.exists()?a.data():null;return{...e,profile:s?{id:a.id,...s}:null}}catch(t){return{...e,profile:null}}}));n(r),d(!1)},[e,P]);v.useEffect(()=>{R()},[R]),v.useEffect(()=>{const e=setInterval(()=>{R()},5e3);return()=>{clearInterval(e)}},[e,R]),v.useEffect(()=>{var e;null==(e=L.current)||e.scrollIntoView({behavior:"smooth"})},[r]);const O=async t=>{t.preventDefault(),o.trim()&&!w&&(D(!0),await k(g(p,"comentarios"),{publicacion_id:e,usuario_id:I.id,texto:o,creado_en:(new Date).toISOString()}),error?P({variant:"destructive",title:"Error al publicar",description:"No se pudo enviar tu comentario."}):l(""),D(!1))};return i.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center",onClick:t,children:i.jsxs("div",{className:"bg-background rounded-2xl shadow-xl w-full max-w-lg h-[90vh] flex flex-col mx-4",onClick:e=>e.stopPropagation(),children:[i.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[i.jsx("h2",{className:"text-xl font-bold text-center flex-grow",children:"Comentarios"}),i.jsx(x,{variant:"ghost",size:"icon",onClick:t,children:i.jsx(C,{className:"h-6 w-6"})})]}),i.jsxs("div",{className:"flex-grow overflow-y-auto p-4 space-y-4",children:[c?i.jsx("p",{className:"text-center text-text-secondary",children:"Cargando comentarios..."}):r.length>0?r.map(e=>{var t,a,s,r,n;return i.jsxs("div",{className:"flex items-start space-x-3",children:[i.jsxs(ke,{className:"h-10 w-10",children:[i.jsx(De,{src:null==(t=e.profile)?void 0:t.profile_picture_url,alt:null==(a=e.profile)?void 0:a.alias}),i.jsx(Me,{children:null==(r=null==(s=e.profile)?void 0:s.alias)?void 0:r[0]})]}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[i.jsx("p",{className:"font-semibold text-sm",children:null==(n=e.profile)?void 0:n.alias}),i.jsx("p",{className:"text-text-primary text-sm",children:e.texto})]}),i.jsx("p",{className:"text-xs text-text-secondary mt-1 ml-2",children:Z(new Date(e.creado_en),{addSuffix:!0,locale:h})})]})]},e.id)}):i.jsx("p",{className:"text-center text-text-secondary py-8",children:"S√© el primero en comentar."}),i.jsx("div",{ref:L})]}),i.jsx("div",{className:"p-4 border-t border-border mt-auto",children:i.jsxs("form",{onSubmit:O,className:"flex items-center space-x-2",children:[i.jsxs(ke,{className:"h-10 w-10",children:[i.jsx(De,{src:null==A?void 0:A.profile_picture_url,alt:null==A?void 0:A.alias}),i.jsx(Me,{children:null==(s=null==A?void 0:A.alias)?void 0:s[0]})]}),i.jsx(f,{value:o,onChange:e=>l(e.target.value),placeholder:"Escribe un comentario...",className:"flex-grow bg-muted border-none focus-visible:ring-primary",rows:1,onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),O(e))}}),i.jsx(x,{type:"submit",size:"icon",disabled:w||!o.trim(),children:i.jsx(E,{className:"h-5 w-5"})})]})})]})})},Ee=({post:e,onLikeToggle:t})=>{const{user:a}=u(),{toast:s}=m(),r=Y(),[n,o]=v.useState(!1),[l,c]=v.useState(null==e?void 0:e.is_liked),[d,x]=v.useState(null==e?void 0:e.likes_count);if(!e||!e.author)return null;const{author:f,text:w,image_url:j,video_url:_,created_at:S,likes_count:M,comments_count:C,id:E}=e;return i.jsxs(i.Fragment,{children:[i.jsxs(T.div,{layout:!0,className:"card-glass p-4 rounded-lg",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>{f&&f.id&&r(`/profile/${f.id}`)},children:[i.jsxs(ke,{children:[i.jsx(De,{src:f.profile_picture_url||"",alt:f.alias}),i.jsx(Me,{children:f.alias?f.alias.charAt(0).toUpperCase():i.jsx(I,{})})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold text-text-primary",children:f.alias||"Usuario An√≥nimo"}),i.jsx("p",{className:"text-xs text-text-secondary",children:Z(new Date(S),{addSuffix:!0,locale:h})})]})]}),i.jsx("button",{className:"text-text-secondary hover:text-primary",children:i.jsx(A,{})})]}),w&&i.jsx("p",{className:"text-text-primary mb-3 whitespace-pre-wrap break-words",children:w}),j&&i.jsx("div",{className:"mb-3 rounded-lg overflow-hidden cursor-pointer",children:i.jsx("img",{src:j,alt:"Contenido de la publicaci√≥n",className:"rounded-md object-cover w-full"})}),_&&i.jsx("div",{className:"mb-3 rounded-lg overflow-hidden",children:i.jsx("video",{src:_,controls:!0,className:"w-full rounded-md"})}),i.jsx("div",{className:"flex items-center justify-between text-text-secondary pt-2 border-t border-border-color",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("button",{className:"flex items-center gap-1.5 hover:text-secondary transition-colors "+(l?"text-secondary":""),onClick:async()=>{if(!a)return void s({variant:"destructive",title:"Debes iniciar sesi√≥n para dar me gusta."});const e=l;c(!e),x(t=>e?t-1:t+1),t(E,!e,e?M-1:M+1);try{if(e){const e=b(g(p,"post_likes"),y("post_id","==",E),y("user_id","==",a.id)),t=await N(e);for(const a of t.docs)await D(a.ref)}else await k(g(p,"post_likes"),{post_id:E,user_id:a.id,created_at:(new Date).toISOString()})}catch(r){c(e),x(t=>e?t+1:t-1),t(E,e,M),s({variant:"destructive",title:e?"Error al quitar el Me Gusta":"Error al dar Me Gusta"})}},children:[i.jsx(P,{className:"w-5 h-5 "+(l?"fill-current":"")}),i.jsx("span",{className:"text-sm",children:d})]}),i.jsxs("button",{className:"flex items-center gap-1.5 hover:text-primary transition-colors",onClick:()=>o(!0),children:[i.jsx(L,{className:"w-5 h-5"}),i.jsx("span",{className:"text-sm",children:C})]})]})})]}),n&&i.jsx(Ce,{postId:E,commentsCount:C,onClose:()=>o(!1)})]})},Te=({ad:e})=>{const{toast:t}=m(),a=(a,s)=>{if("promo"!==e.type)t({title:"‚ö†Ô∏è Salir de la app",description:"Est√°s saliendo de la aplicaci√≥n para contactar al anunciante.",duration:3e3}),setTimeout(()=>{switch(a){case"contact_phone":window.location.href=`tel:${s}`;break;case"contact.email":window.location.href=`mailto:${s}`;break;case"website":window.open(s,"_blank");break;case"whatsapp":window.open(`https://wa.me/${s.replace(/[^0-9]/g,"")}`,"_blank")}},1500);else switch(e.promo_type){case"VIP":t({title:"üéØ VIP - Funcionalidad en desarrollo",description:"Muy pronto podr√°s obtener VIP para destacar tu perfil.",duration:3e3});break;case"AUTOMARKET":window.open(e.website,"_blank")}},s=["bg-gradient-to-br from-blue-500 to-purple-600","bg-gradient-to-br from-green-500 to-teal-600","bg-gradient-to-br from-orange-500 to-red-600","bg-gradient-to-br from-pink-500 to-rose-600","bg-gradient-to-br from-indigo-500 to-blue-600"],r=s[Math.floor(Math.random()*s.length)];return i.jsxs("div",{className:`${r} rounded-lg p-4 text-white relative overflow-hidden`,children:[i.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full -translate-y-10 translate-x-10"}),i.jsx("div",{className:"absolute bottom-0 left-0 w-16 h-16 bg-white/10 rounded-full translate-y-8 -translate-x-8"}),i.jsxs("div",{className:"relative z-10",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsx("div",{className:"bg-white/20 px-2 py-1 rounded-full",children:i.jsx("span",{className:"text-xs font-medium",children:"promo"===e.type?"PROMOCI√ìN":"PUBLICIDAD"})}),e.ad_type&&"promo"!==e.ad_type&&i.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium "+("premium"===e.ad_type?"bg-yellow-400/30 text-yellow-200":"bg-blue-400/30 text-blue-200"),children:"premium"===e.ad_type?"‚≠ê PREMIUM":"üì¢ EST√ÅNDAR"})]}),i.jsx(R,{className:"w-4 h-4 opacity-70"})]}),i.jsxs("div",{className:"mb-4",children:[i.jsx("h3",{className:"font-bold text-lg mb-1",children:e.title||"Anuncio"}),i.jsx("p",{className:"text-white/90 text-sm mb-2",children:e.description||"Descripci√≥n del anuncio"}),e.company_info&&i.jsx("p",{className:"text-white/80 text-xs",children:e.company_info}),e.price&&i.jsxs("p",{className:"text-white/80 text-xs font-bold",children:["$",e.price," USD"]})]}),i.jsx("div",{className:"grid grid-cols-2 gap-2",children:"promo"===e.type?"VIP"===e.promo_type?i.jsxs(x,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a(),children:[i.jsx("span",{children:"üöÄ"}),"Obtener VIP"]}):"AUTOMARKET"===e.promo_type?i.jsxs(x,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a(),children:[i.jsx(O,{className:"w-3 h-3 mr-1"}),"Ver AutoMarket"]}):null:i.jsxs(i.Fragment,{children:[e.contact_phone&&i.jsxs(x,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a("phone",e.contact_phone),children:[i.jsx(z,{className:"w-3 h-3 mr-1"}),"Llamar"]}),e.contact_email&&i.jsxs(x,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a("email",e.contact_email),children:[i.jsx(X,{className:"w-3 h-3 mr-1"}),"Email"]}),e.contact_website&&i.jsxs(x,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a("website",e.contact_website),children:[i.jsx(O,{className:"w-3 h-3 mr-1"}),"Web"]}),e.contact_whatsapp&&i.jsxs(x,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a("whatsapp",e.contact_whatsapp),children:[i.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"WhatsApp"]})]})})]})]})},Ie=()=>{const{user:e}=u(),{toast:t}=m(),[a,s]=v.useState([]),[r,n]=v.useState([]),[o,l]=v.useState([]),[c,d]=v.useState(!0),[x,h]=v.useState(!1),[f,w]=v.useState(0),[D,C]=v.useState(!0),E=v.useCallback(async()=>{if(null==e?void 0:e.uid)try{d(!0);const e=g(p,"posts"),t=b(e,j("created_at","desc"),M(20)),a=await N(t),r=await Promise.all(a.docs.map(async e=>{const t={id:e.id,...e.data()};try{const e=_(p,"profiles",t.user_id),a=await S(e);a.exists()&&(t.author={id:a.id,...a.data()})}catch(a){}try{const e=g(p,"post_likes"),a=b(e,y("post_id","==",t.id)),s=await N(a);t.likes=s.docs.map(e=>({id:e.id,...e.data()}))}catch(a){t.likes=[]}return t})),i=g(p,"advertisements"),o=b(i,y("status","==","active"),M(10));let c=(await N(o)).docs.map(e=>({id:e.id,...e.data(),type:"ad",source:"advertising_portal"}));const u=[{id:"banner-vip",type:"promo",title:"Obten√© VIP",description:"Tu perfil destacado por 30 d√≠as",image_url:"/pwa-512x512.png",price:15,promo_type:"VIP",ad_type:"promo"},{id:"banner-automarket",title:"AutoMarket",description:"Compra y venta de autos",type:"promo",image_url:"/pwa-512x512.png",website:"https://auto-market.pro",promo_type:"AUTOMARKET",ad_type:"promo"}];c=[...c,...u],s(r),n(c);const m=[];let x=0;if(0===r.length)m.push(...c);else{for(let e=0;e<r.length;e+=6){const t=r.slice(e,e+6);if(m.push(...t),x<c.length){const e=c.slice(x,x+2);m.push(...e),x+=2}}if(x<c.length){const e=c.slice(x);m.push(...e)}}l(m)}catch(t){l([])}finally{d(!1)}else d(!1)},[null==e?void 0:e.uid,t]);v.useEffect(()=>{E()},[E]);const T=async a=>{if(null==e?void 0:e.uid)try{const s=g(p,"post_likes"),r=b(s,y("post_id","==",a),y("user_id","==",e.uid)),i=await N(r);if(i.empty)await k(s,{post_id:a,user_id:e.uid,created_at:new Date}),t({title:"‚ù§Ô∏è Like agregado",description:"Tu like ha sido registrado"});else{const e=i.docs[0];await deleteDoc(_(p,"post_likes",e.id)),t({title:"üíî Like removido",description:"Tu like ha sido removido"})}E()}catch(s){t({variant:"destructive",title:"Error",description:"No se pudo procesar el like"})}};return c&&0===o.length?i.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:i.jsxs("div",{className:"text-center",children:[i.jsx(V,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary"}),i.jsx("p",{className:"text-text-secondary",children:"Cargando publicaciones..."})]})}):0!==o.length||c?i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("h2",{className:"text-2xl font-bold text-primary",children:"Descubrir"}),i.jsx("button",{onClick:async()=>{h(!0),await E(),h(!1)},disabled:x,className:"p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors",children:i.jsx(F,{className:"w-5 h-5 "+(x?"animate-spin":"")})})]}),i.jsx($,{}),i.jsx("div",{className:"space-y-4",children:o.map((t,a)=>i.jsx("div",{children:"ad"===t.type||"promo"===t.type?i.jsx(Te,{ad:t}):i.jsx(Ee,{post:t,onLike:T,currentUserId:null==e?void 0:e.uid})},t.id||a))}),c&&o.length>0&&i.jsx("div",{className:"flex justify-center py-4",children:i.jsx(V,{className:"w-6 h-6 animate-spin text-primary"})})]}):i.jsxs("div",{className:"text-center py-12",children:[i.jsx(U,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),i.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No hay publicaciones"}),i.jsx("p",{className:"text-gray-500 mb-4",children:"S√© el primero en compartir algo"}),i.jsx($,{})]})};export{Ie as default};
