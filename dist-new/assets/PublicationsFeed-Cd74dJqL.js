import{j as e,c as t,P as s,b as a,e as i,f as r,a as o,B as l,u as n,d as c,D as d}from"./index-CWwLTSSO.js";import{r as u,R as p}from"./vendor-npDLdgAy.js";import{m,q as h,n as x,p as f,r as g,d as w,c as v,w as b,y as j,e as y}from"./firebase-CUPWofxp.js";import N from"./CreatePost-C8MXgRjI.js";import{ag as _,ah as k,ai as S,$ as C,L as P,Z as E,aj as A,l as I,n as L,f as R,H as M}from"./ui-ixqAzGDE.js";import{u as O}from"./router-Ba8Cb_LR.js";var T={exports:{}},z={},V=u;var D="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},$=V.useState,U=V.useEffect,F=V.useLayoutEffect,q=V.useDebugValue;function B(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!D(e,s)}catch(a){return!0}}var K="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var s=t(),a=$({inst:{value:s,getSnapshot:t}}),i=a[0].inst,r=a[1];return F(function(){i.value=s,i.getSnapshot=t,B(i)&&r({inst:i})},[e,s,t]),U(function(){return B(i)&&r({inst:i}),e(function(){B(i)&&r({inst:i})})},[e]),q(s),s};z.useSyncExternalStore=void 0!==V.useSyncExternalStore?V.useSyncExternalStore:K,T.exports=z;var W=T.exports;function H(){return()=>{}}var Y="Avatar",[Z,G]=t(Y),[J,Q]=Z(Y),X=u.forwardRef((t,a)=>{const{__scopeAvatar:i,...r}=t,[o,l]=u.useState("idle");return e.jsx(J,{scope:i,imageLoadingStatus:o,onImageLoadingStatusChange:l,children:e.jsx(s.span,{...r,ref:a})})});X.displayName=Y;var ee="AvatarImage",te=u.forwardRef((t,r)=>{const{__scopeAvatar:o,src:l,onLoadingStatusChange:n=()=>{},...c}=t,d=Q(ee,o),p=function(e,{referrerPolicy:t,crossOrigin:s}){const a=W.useSyncExternalStore(H,()=>!0,()=>!1),r=u.useRef(null),o=a?(r.current||(r.current=new window.Image),r.current):null,[l,n]=u.useState(()=>ie(o,e));return i(()=>{n(ie(o,e))},[o,e]),i(()=>{const e=e=>()=>{n(e)};if(!o)return;const a=e("loaded"),i=e("error");return o.addEventListener("load",a),o.addEventListener("error",i),t&&(o.referrerPolicy=t),"string"==typeof s&&(o.crossOrigin=s),()=>{o.removeEventListener("load",a),o.removeEventListener("error",i)}},[o,s,t]),l}(l,c),m=a(e=>{n(e),d.onImageLoadingStatusChange(e)});return i(()=>{"idle"!==p&&m(p)},[p,m]),"loaded"===p?e.jsx(s.img,{...c,ref:r,src:l}):null});te.displayName=ee;var se="AvatarFallback",ae=u.forwardRef((t,a)=>{const{__scopeAvatar:i,delayMs:r,...o}=t,l=Q(se,i),[n,c]=u.useState(void 0===r);return u.useEffect(()=>{if(void 0!==r){const e=window.setTimeout(()=>c(!0),r);return()=>window.clearTimeout(e)}},[r]),n&&"loaded"!==l.imageLoadingStatus?e.jsx(s.span,{...o,ref:a}):null});function ie(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}ae.displayName=se;var re=X,oe=te,le=ae;p.forwardRef(({className:t,...s},a)=>e.jsx(re,{ref:a,className:r("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s})).displayName=re.displayName;p.forwardRef(({className:t,...s},a)=>e.jsx(oe,{ref:a,className:r("aspect-square h-full w-full",t),...s})).displayName=oe.displayName;p.forwardRef(({className:t,...s},a)=>e.jsx(le,{ref:a,className:r("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...s})).displayName=le.displayName;const ne=({ad:t})=>{const{toast:s}=o(),a=(e,a)=>{if("promo"!==t.type)s({title:"‚ö†Ô∏è Salir de la app",description:"Est√°s saliendo de la aplicaci√≥n para contactar al anunciante.",duration:3e3}),setTimeout(()=>{switch(e){case"contact_phone":window.location.href=`tel:${a}`;break;case"contact.email":window.location.href=`mailto:${a}`;break;case"website":window.open(a,"_blank");break;case"whatsapp":window.open(`https://wa.me/${a.replace(/[^0-9]/g,"")}`,"_blank")}},1500);else switch(t.promo_type){case"VIP":s({title:"üéØ VIP - Funcionalidad en desarrollo",description:"Muy pronto podr√°s obtener VIP para destacar tu perfil.",duration:3e3});break;case"AUTOMARKET":window.open(t.website,"_blank")}},i=["bg-gradient-to-br from-blue-500 to-purple-600","bg-gradient-to-br from-green-500 to-teal-600","bg-gradient-to-br from-orange-500 to-red-600","bg-gradient-to-br from-pink-500 to-rose-600","bg-gradient-to-br from-indigo-500 to-blue-600"],r=i[Math.floor(Math.random()*i.length)];return e.jsxs("div",{className:`${r} rounded-lg p-4 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full -translate-y-10 translate-x-10"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-16 h-16 bg-white/10 rounded-full translate-y-8 -translate-x-8"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"bg-white/20 px-2 py-1 rounded-full",children:e.jsx("span",{className:"text-xs font-medium",children:"promo"===t.type?"PROMOCI√ìN":"PUBLICIDAD"})}),t.ad_type&&"promo"!==t.ad_type&&e.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium "+("premium"===t.ad_type?"bg-yellow-400/30 text-yellow-200":"bg-blue-400/30 text-blue-200"),children:"premium"===t.ad_type?"‚≠ê PREMIUM":"üì¢ EST√ÅNDAR"})]}),e.jsx(_,{className:"w-4 h-4 opacity-70"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-bold text-lg mb-1",children:t.title||"Anuncio"}),e.jsx("p",{className:"text-white/90 text-sm mb-2",children:t.description||"Descripci√≥n del anuncio"}),t.company_info&&e.jsx("p",{className:"text-white/80 text-xs",children:t.company_info}),t.price&&e.jsxs("p",{className:"text-white/80 text-xs font-bold",children:["$",t.price," USD"]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:"promo"===t.type?"VIP"===t.promo_type?e.jsxs(l,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a(),children:[e.jsx("span",{children:"üöÄ"}),"Obtener VIP"]}):"AUTOMARKET"===t.promo_type?e.jsxs(l,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a(),children:[e.jsx(k,{className:"w-3 h-3 mr-1"}),"Ver AutoMarket"]}):null:e.jsxs(e.Fragment,{children:[t.contact_phone&&e.jsxs(l,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a("phone",t.contact_phone),children:[e.jsx(S,{className:"w-3 h-3 mr-1"}),"Llamar"]}),t.contact_email&&e.jsxs(l,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a("email",t.contact_email),children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),"Email"]}),t.contact_website&&e.jsxs(l,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a("website",t.contact_website),children:[e.jsx(k,{className:"w-3 h-3 mr-1"}),"Web"]}),t.contact_whatsapp&&e.jsxs(l,{size:"sm",variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-0 text-xs",onClick:()=>a("whatsapp",t.contact_whatsapp),children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"WhatsApp"]})]})})]})]})},ce=u.forwardRef((t,s)=>{const{user:a}=n(),{toast:i}=o(),r=O(),[l,p]=u.useState([]),[_,k]=u.useState([]),[S,C]=u.useState([]),[T,z]=u.useState(!0),[V,D]=u.useState(!1),[$,U]=u.useState(null),[F,q]=u.useState(null),[B,K]=u.useState(!1),[W,H]=u.useState(!1),[Y,Z]=u.useState({}),G=u.useCallback(async()=>{var e;if(null==a?void 0:a.uid)try{z(!0);const s=m(c,"posts"),i=h(s,x("created_at","desc"),f(20)),r=await g(i),o=await Promise.all(r.docs.map(async e=>{const t={id:e.id,...e.data()};try{const e=w(c,"profiles",t.user_id),s=await v(e);s.exists()&&(t.author={id:s.id,...s.data()})}catch(s){}try{const e=m(c,"post_likes"),s=h(e,b("post_id","==",t.id)),i=await g(s);t.likes=i.docs.map(e=>({id:e.id,...e.data()})),t.likes_count=t.likes.length,t.is_liked=t.likes.some(e=>e.user_id===a.uid)}catch(s){t.likes=[],t.likes_count=0,t.is_liked=!1}return t})),l={};for(const p of o)if(null==(e=p.author)?void 0:e.id)try{const e=m(c,"user_likes"),t=h(e,b("user_id","==",a.uid),b("liked_user_id","==",p.author.id)),s=await g(t);l[p.author.id]=s.size>0}catch(t){l[p.author.id]=!1}Z(l);const n=m(c,"advertisements"),d=h(n,b("status","==","active"),f(10));let u=(await g(d)).docs.map(e=>({id:e.id,...e.data(),type:"ad",source:"advertising_portal"}));const j=[{id:"banner-vip",type:"promo",title:"Obten√© VIP",description:"Tu perfil destacado por 30 d√≠as",image_url:"/pwa-512x512.png",price:15,promo_type:"VIP",ad_type:"promo"},{id:"banner-automarket",title:"AutoMarket",description:"Compra y venta de autos",type:"promo",image_url:"/pwa-512x512.png",website:"https://auto-market.pro",promo_type:"AUTOMARKET",ad_type:"promo"}];u=[...u,...j],p(o),k(u);const y=[];let N=0;if(0===o.length)y.push(...u);else{for(let e=0;e<o.length;e+=6){const t=o.slice(e,e+6);if(y.push(...t),N<u.length){const e=u.slice(N,N+2);y.push(...e),N+=2}}if(N<u.length){const e=u.slice(N);y.push(...e)}}C(y)}catch(t){C([])}finally{z(!1)}else z(!1)},[null==a?void 0:a.uid,i]);u.useEffect(()=>{G()},[G]);const J=(e,t,s)=>{switch(e){case"message":U(t),K(!0);break;case"profile":r(`/profile/${t.id}`);break;case"view":r(`/post/${s.id}`)}},Q=async()=>{D(!0),await G(),D(!1)};return u.useImperativeHandle(s,()=>({handleRefresh:Q})),T&&0===S.length?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(P,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary"}),e.jsx("p",{className:"text-text-secondary",children:"Cargando publicaciones..."})]})}):0!==S.length||T?e.jsxs("div",{className:"space-y-6",children:[e.jsx(N,{}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:S.map((t,s)=>{var o,l,n,d,u;return e.jsx("div",{className:"relative",children:"ad"===t.type||"promo"===t.type?e.jsx(ne,{ad:t}):e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"card-glass rounded-lg overflow-hidden cursor-pointer",children:[e.jsxs("div",{className:"absolute top-2 right-2 z-20",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),q(t),H((null==F?void 0:F.id)!==t.id)},className:"bg-black/50 rounded-full p-1 text-white hover:bg-black/70 transition-colors",children:e.jsx(A,{className:"w-4 h-4"})}),W&&(null==F?void 0:F.id)===t.id&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-30",onClick:e=>{e.stopPropagation(),H(!1),q(null)}}),e.jsxs("div",{className:"absolute top-8 right-0 z-40 bg-white/95 backdrop-blur-sm rounded-lg shadow-lg border border-gray-200 py-1 min-w-[160px]",children:[e.jsxs("button",{onClick:e=>{e.stopPropagation(),H(!1),J("message",F.author,F),q(null)},className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-gray-100 transition-colors text-left",children:[e.jsx(I,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm",children:"Mensaje"})]}),e.jsxs("button",{onClick:e=>{e.stopPropagation(),H(!1),J("profile",F.author,F),q(null)},className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-gray-100 transition-colors text-left",children:[e.jsx(L,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Ver perfil"})]}),e.jsxs("button",{onClick:e=>{e.stopPropagation(),H(!1),J("view",F.author,F),q(null)},className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-gray-100 transition-colors text-left",children:[e.jsx(R,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-sm",children:"Ver post"})]})]})]})]}),e.jsxs("div",{onClick:()=>r(`/post/${t.id}`),className:"aspect-square relative cursor-pointer",children:[t.image_url&&e.jsx("img",{src:t.image_url,alt:"Post",className:"w-full h-full object-cover"}),t.video_url&&e.jsx("video",{src:t.video_url,className:"w-full h-full object-cover",muted:!0})]}),e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("img",{src:(null==(o=t.author)?void 0:o.profile_picture_url)||"/pwa-512x512.png",alt:null==(l=t.author)?void 0:l.alias,className:"w-6 h-6 rounded-full object-cover"}),e.jsx("span",{className:"text-sm font-medium",children:null==(n=t.author)?void 0:n.alias})]}),t.text&&e.jsx("p",{className:"text-sm text-gray-700 mb-2 line-clamp-2",children:t.text}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:e=>{e.stopPropagation(),(async e=>{if(null==a?void 0:a.uid)try{const t=m(c,"post_likes"),s=h(t,b("post_id","==",e),b("user_id","==",a.uid)),r=await g(s);if(r.empty)await j(t,{post_id:e,user_id:a.uid,created_at:(new Date).toISOString()}),i({title:"‚ù§Ô∏è Like agregado",description:"Tu like ha sido registrado"});else{const e=r.docs[0];await y(w(c,"post_likes",e.id)),i({title:"üíî Like removido",description:"Tu like ha sido removido"})}G()}catch(t){i({variant:"destructive",title:"Error",description:"No se pudo procesar el like"})}})(t.id)},className:`flex items-center gap-1 ${t.is_liked?"text-red-500":"text-gray-400"} hover:text-red-500 transition-colors`,children:[e.jsx(M,{className:"w-4 h-4 "+(t.is_liked?"fill-current":"")}),e.jsx("span",{className:"text-xs",children:t.likes_count})]}),e.jsx("button",{onClick:e=>{var s;e.stopPropagation(),(async e=>{if((null==a?void 0:a.uid)&&e)try{if(Y[e]){const t=m(c,"user_likes"),s=h(t,b("user_id","==",a.uid),b("liked_user_id","==",e)),r=await g(s);for(const e of r.docs)await y(w(c,"user_likes",e.id));Z(t=>({...t,[e]:!1})),i({title:"Dejaste de seguir",description:"Ya no sigues a este usuario"})}else await j(m(c,"user_likes"),{user_id:a.uid,liked_user_id:e,created_at:(new Date).toISOString()}),Z(t=>({...t,[e]:!0})),i({title:"¬°Siguiendo!",description:"Ahora sigues a este usuario"});G()}catch(t){i({variant:"destructive",title:"Error",description:"No se pudo procesar la acci√≥n"})}})(null==(s=t.author)?void 0:s.id)},className:"text-xs px-2 py-1 rounded-full transition-colors "+(Y[null==(d=t.author)?void 0:d.id]?"bg-red-500 text-white hover:bg-red-600":"bg-green-500 text-white hover:bg-green-600"),children:Y[null==(u=t.author)?void 0:u.id]?"Siguiendo":"Seguir"})]})]})]})})},t.id||s)})}),T&&S.length>0&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(P,{className:"w-6 h-6 animate-spin text-primary"})}),$&&e.jsx(d,{profile:$,onClose:()=>{K(!1),U(null)}})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No hay publicaciones"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"S√© el primero en compartir algo"}),e.jsx(N,{})]})});ce.displayName="PublicationsFeed";export{ce as default};
